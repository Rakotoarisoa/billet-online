{% extends 'base.html.twig' %}
{% block title %}
    {{ event.titreEvenement }} | Plan de salle
{% endblock %}
{% block breadcrumb %}
{% endblock %}
{% block header %}
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.css"/>
{% endblock %}
{% block body %}
    {% block content %}
        {{ parent() }}
        <section>
            <div class="row mr-15 mt-15 ml-15 mb-15">
                <div class="col">
                    <h4>{{ event.titreEvenement }}</h4>
                </div>
                <div class="col-3">
                    <a href="{{ url('viewSingle',{'id':event.id}) }}"
                       class="btn btn-danger">{{ 'events.return_to_event'|trans }}</a>
                </div>
            </div>
            <div id="root" data-event-id="{{ event.id }}" data-is-front="true" class="container-fluid">
                <div class="preloader d-flex align-items-center justify-content-center">
                    <div class="lds-ellipsis">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
        </section>
        <div class="modal" id="checkout_command" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="col"></div>
                        <div class="col">
                            <div class="row"><p class="modal-title mx-auto" id="exampleModalLabel">Commander</p></div>
                            <div class="row">
                                <small class="mx-auto">Temps restant pour commander: <span
                                            class="time_left">00:00</span></small>
                            </div>
                        </div>
                        <div class="col">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-7">
                                <div class="container-fluid">
                                    <h6 class="mx-auto">Informations de commande</h6>
                                    <hr/>
                                    <form>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="inputEmail4">Nom</label>
                                                <input type="nom" class="form-control" id="nom" placeholder="Nom">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="inputPassword4">Prénom</label>
                                                <input type="prenom" class="form-control" id="prenom"
                                                       placeholder="Prénom">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="inputAddress">Adresse</label>
                                            <input type="text" class="form-control" id="inputAddress"
                                                   placeholder="Ivandry">
                                        </div>
                                        <div class="form-group">
                                            <label for="inputAddress2">Logement</label>
                                            <input type="text" class="form-control" id="inputAddress2"
                                                   placeholder="Logement">
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-5">
                                                <label for="inputCity">Pays</label>
                                                <input type="text" class="form-control" id="inputCity">
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label for="inputState">Région</label>
                                                <select id="inputState" class="form-control">
                                                    <option selected>Choose...</option>
                                                    <option>...</option>
                                                </select>
                                            </div>
                                            <div class="form-group col-md-3">
                                                <label for="inputZip">Code postal</label>
                                                <input type="text" class="form-control" id="inputZip">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="form-group">
                                            <label for="inputAddress2"><h6>Méthode de paiement</h6></label>
                                            <div class="row">
                                                <div class="col-6"><span class="fa fa-credit-card fa-2x"></span>  Carte bancaire</div>
                                            </div>
                                            <hr/>
                                            <div class="row">
                                                <div id="btnPaypal" class="col-6"></div>
                                            </div>
                                            <hr/>
                                            <div class="row">
                                                <div class="col-6"><img src="{{ asset('img/logo-mvola.png.png') }}" width="100" height="30"/> </div>
                                            </div>
                                            <hr/>
                                            <button type="button" class="btn btn-danger pull-right">Valider</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="col-5">
                                <div class="container-fluid">

                                    <h6 class="mx-auto">Résumé de la commande</h6>
                                    <hr/>
                                    <div class="row">
                                        <div class="col-8">3x Billet "Simple"</div>
                                        <div class="col"><p class="pull-right"><span class="currency">Ar</span> 10.000</p></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-8">1x Billet "Reservation"</div>
                                        <div class="col"><p class="pull-right"><span class="currency">Ar</span> 20.000</p></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-8">2x Billet "VIP"</div>
                                        <div class="col"><p class="pull-right"><span class="currency">Ar</span> 100.000</p></div>
                                    </div>
                                    <hr/>
                                    <div class="row">
                                        <div class="col-8">Sous-total</div>
                                        <div class="col"><p class="pull-right"><span class="currency">Ar</span> 130.000</p></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-8">Frais</div>
                                        <div class="col"><p class="pull-right"><span class="currency">Ar</span> 10000</p></div>
                                    </div>
                                    <hr/>
                                    <div class="row">
                                        <div class="col-8"><h6>Total</h6></div>
                                        <div class="col"><p class="pull-right"><span class="currency">Ar</span> 140.000</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endblock %}
    {% block contact %}{% endblock %}
    {% block footer %}{% endblock %}
    {% block javascripts %}
        <!-- ##### All Javascript Script ##### -->
        <!-- jQuery-2.2.4 js -->
        <script src="{{ asset('js/jquery/jquery-2.2.4.min.js') }}"></script>
        <!-- Popper js -->
        <script src="{{ asset('js/bootstrap/popper.min.js') }}"></script>
        <!-- Bootstrap js -->
        <script src="{{ asset('js/bootstrap/bootstrap.min.js') }}"></script>
        <!-- All Plugins js -->
        <script src="{{ asset('js/plugins/plugins.js') }}"></script>
        <!-- Active js -->
        <script src="{{ asset('js/active.js') }}"></script>
        <!-- Build js -->
        <script type="text/javascript" src="{{ asset('build/js/app.js') }}"></script>
        <script src="https://www.paypal.com/sdk/js?client-id=AXZ-9C193mTXkOfkwZ0ehMUiaNbVXM20I9xbh65Rk8HseaqLYuOJxjCy6wpyaCfPRaWmvfAzo5S_FwIU&currency=EUR"></script>
        <script type="text/javascript">
            let start_counter = 8 * 60; //n minutes X 60
            let end_counter = 0;
            let cart_items = [];
            $('#checkout_command').on('shown.bs.modal', function () {
                let checkout_timer = setInterval(function () {
                    --start_counter;
                    $('.time_left').text(format(start_counter));
                    if (start_counter === 0) {
                        clearInterval(checkout_timer);
                        $('#checkout_command').modal('hide');
                    }
                }, 1000);
                $.get('/api/cart/list', function (data, status) {
                    cart_items = data;
                });


            });

            function format(time) {
                // Hours, minutes and seconds
                var hrs = ~~(time / 3600);
                var mins = ~~((time % 3600) / 60);
                var secs = ~~time % 60;

                // Output like "1:01" or "4:03:59" or "123:03:59"
                var ret = "";
                if (hrs > 0) {
                    ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
                }
                ret += "" + mins + ":" + (secs < 10 ? "0" : "");
                ret += "" + secs;
                return ret;
            }

            function transformItemsPaypalFormat(cart_items) {
                let formatted_cart = [];
                cart_items.forEach(function (el) {
                    let item = {
                        name: el.name,
                        quantity: el.quantity,
                        currency: "EUR",
                        unit_amount: {
                            value: el.price,
                            currency_code: "EUR"
                        }
                    };
                    formatted_cart.push(item);
                });
                return formatted_cart;
            }

            $('#checkout_command').on('hide.bs.modal', function () {

            });


            /*$('#validatePaymentMode').on('click', function (e) {
                var radioValue = $("input[name='optPayment']:checked").val();
                if (radioValue == 'paypal') {
                    $('#btnPaypal').show();
                }
                if (radioValue == 'mvola') {
                    $('#btnPaypal').hide();
                }
                if (radioValue == 'airtelMoney') {
                    $('#btnPaypal').hide();
                }
            });
*/
            paypal.Buttons({
                style: {
                    layout: 'horizontal'
                },
                createOrder: function (data, actions) {
                    // Set up the transaction
                    return actions.order.create({
                        purchase_units: [{
                            application_context: {
                                brand_name: 'Ivenco',
                                return_url: '/res_billet/checkout',
                                cancel_url: '/res_billet/cancel'
                            },
                            amount: {
                                breakdown: {
                                    item_total: {
                                        currency_code: "EUR",
                                        value: "{{ not app.session.get('totalPrice') ? "0" : app.session.get('totalPrice') }}"
                                    }
                                },
                                currency_code: "EUR",
                                value: "{{ not app.session.get('totalPrice') ? "0" : app.session.get('totalPrice') }}"
                            },
                            items:
                                transformItemsPaypalFormat(cart_items)
                        }],

                    });
                },
                onApprove: function (data, actions) {
                    // Capture the funds from the transaction
                    return actions.order.capture().then(function (details) {
                        // Show a success message to your buyer
                        console.log('Transaction completed by ' + details.payer.name.given_name);
                        location.href = "/res_billet/checkout";
                    });
                }
            }).render('#btnPaypal');
        </script>
    {% endblock %}
{% endblock %}
