{% extends 'base.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/bs4/dt-1.10.18/r-2.2.2/sl-1.3.0/datatables.min.css"/>
{% endblock %}
{% block head_javascripts %}

{% endblock %}
{% block breadcrumb %}
    <section class="breadcumb-area bg-img bg-overlay" style="background-image: url({{ asset('img/breadcumb3.jpg') }}">
        <div class="bradcumbContent">
            {% block breadcrumb_content %}
                <h2>Commande de billets</h2>
            {% endblock %}
        </div>
    </section>
{% endblock %}
{% block body %}
    <!-- ##### Events Area Start ##### -->
    {% block content %}
        <section class="section-padding-100">
            {{ parent() }}
            <div class="container">
                <div class="row">
                    <div class="col-sm-12 col-lg-12">
                        <table id="cart" class="table table-hover table-condensed">
                            <thead>
                            <tr>
                                <th style="width:50%">Billets</th>
                                <th style="width:20%">Type de billet</th>
                                <th style="width:5%">Quantité</th>
                                <th style="width:10%">Prix</th>
                                <th style="width:22%" class="text-center">Sous-total</th>
                                <th style="width:10%"></th>
                            </tr>
                            </thead>
                            {% if (cart|length >0) %}
                            <tbody>

                            {% for item in cart %}
                                <tr>
                                    <td>{{ item.name }}</td>
                                    <td>{{ item.categoryStr }}</td>
                                    <td>{{ item.quantity }}</td>
                                    <td>€ {{ item.price }}</td>
                                    <td data-th="Subtotal" class="text-center">
                                        {% set var_1 = 0 + item.quantity|number_format(2,'.',',') %}

                                        € {{ (var_1 * item.price)|number_format(2,'.',',') }}
                                    </td>
                                    <td>
                                        <a class="btn btn-danger btn-sm" href="{{ path('cart_remove',{'id': item.id}) }}"><i
                                                    class="fa fa-trash-o"></i></a>
                                    </td>
                                </tr>
                            {% endfor %}

                            </tbody>
                            <tfoot>
                            <tr class="visible-xs">
                                <td class="text-center"><strong>Total</strong></td>
                            </tr>
                            <tr>
                                <td><a href="{{ path('viewList') }}" class="btn btn-warning"><i class="fa fa-angle-left"></i> Retour à la page d'accueil</a>
                                </td>
                                <td></td>
                                <td>
                                    <a class="btn btn-info" href="{{ path('cart_clear') }}">Vider la liste des billets <i
                                                class="fa fa-refresh"></i></a>
                                </td>
                                <td class="hidden-xs text-center"><strong>Total €{{ not app.session.get('totalPrice') ? "0" : app.session.get('totalPrice') }}</strong>
                                </td>
                                <td><a role="button" data-toggle="collapse" data-target="#paymentMode" aria-expanded="false" class="btn btn-success btn-block">Payer <i class="fa fa-angle-right"></i></a>
                                </td>
                            </tr>
                            <!--<tr>
                                <form action="" method="post">
                                    <td><input type="text" name="coupon" class="form-control" value="">
                                        <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}"></td>
                                    <td><button type="submit" class="btn btn-success btn-block">Redeem Coupon</button></td>
                                    <td class="hidden-xs text-center"></td>
                                    <td></td>
                                </form>
                            </tr>-->

                            </tfoot>
                                {% else %}
                                <p>Aucun billet à commander</p>
                            {% endif %}
                        </table>
                    </div>
                </div>
                <div class="collapse" id="paymentMode">
                    <div id="btnPay" class="card card-body col-sm-3">
                        <script src="https://www.paypal.com/sdk/js?client-id=AXZ-9C193mTXkOfkwZ0ehMUiaNbVXM20I9xbh65Rk8HseaqLYuOJxjCy6wpyaCfPRaWmvfAzo5S_FwIU&currency=EUR"></script>
                                <script>paypal.Buttons({
                                        style: {
                                            layout: 'horizontal'
                                        },
                                        createOrder: function(data, actions) {
                                            // Set up the transaction
                                            return actions.order.create({
                                                purchase_units: [{
                                                    application_context:{
                                                        brand_name:'Ivenco',
                                                        return_url:'/res_billet/checkout',
                                                        cancel_url:'/res_billet/cancel'
                                                    },
                                                    amount: {
                                                        breakdown:{item_total:{
                                                                currency_code:"EUR",
                                                                value:"{{ not app.session.get('totalPrice') ? "0" : app.session.get('totalPrice') }}"}},
                                                        currency_code: "EUR",
                                                        value: "{{ not app.session.get('totalPrice') ? "0" : app.session.get('totalPrice') }}"
                                                    },
                                                    items:

                                                        [

                                                            {% for item in cart %}
                                                            {
                                                                name: "{{ item.name }}",
                                                                quantity:"{{ item.quantity }}",
                                                                currency:"EUR",
                                                                unit_amount:{
                                                                    value:"{{ item.price }}",
                                                                    currency_code: "EUR"
                                                                }
                                                            },
                                                            {% endfor %}

                                                        ]


                                                }],

                                            });
                                        },
                                        onApprove: function(data, actions) {
                                            // Capture the funds from the transaction
                                            return actions.order.capture().then(function(details) {
                                                // Show a success message to your buyer
                                                alert('Transaction completed by ' + details.payer.name.given_name);
                                            });
                                        }
                                    }).render('#btnPay');</script>
                    </div>
                </div>
            </div>

        </section>
    {% endblock %}
    {% block javascripts %}
        {{ parent() }}
    {% endblock %}
{% endblock %}
{% block contact %}
{% endblock %}

